<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AGRI-OS LIVE Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap');
        
        :root {
            --glass: rgba(15, 23, 42, 0.6);
            --glass-border: rgba(255, 255, 255, 0.12);
            --emerald-glow: rgba(16, 185, 129, 0.4);
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: #020617;
            background: 
                radial-gradient(circle at 0% 0%, rgba(16, 185, 129, 0.08) 0%, transparent 40%),
                radial-gradient(circle at 100% 100%, rgba(59, 130, 246, 0.08) 0%, transparent 40%),
                #020617;
            background-attachment: fixed;
            overflow-x: hidden;
            margin: 0;
        }

        #particle-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            pointer-events: none;
        }

        .liquid-glass {
            background: var(--glass);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid var(--glass-border);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
            position: relative;
            overflow: hidden;
        }

        .liquid-glass::before {
            content: "";
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(255, 255, 255, 0.05),
                transparent
            );
            transition: 0.5s;
        }

        .liquid-glass:hover::before {
            left: 100%;
        }

        .glow-emerald { box-shadow: 0 0 20px var(--emerald-glow); }
        
        .animate-liquid {
            animation: liquid-move 10s infinite alternate;
        }

        @keyframes liquid-move {
            0% { border-radius: 60% 40% 30% 70% / 60% 30% 70% 40%; }
            50% { border-radius: 30% 60% 70% 40% / 50% 60% 30% 60%; }
            100% { border-radius: 60% 40% 30% 70% / 60% 30% 70% 40%; }
        }

        .chart-container canvas {
            filter: drop-shadow(0 0 10px rgba(16, 185, 129, 0.1));
        }

        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: #020617; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
    </style>
</head>
<body class="text-slate-200 p-4 md:p-8 min-h-screen">

    <canvas id="particle-canvas"></canvas>

    <div class="fixed top-[-10%] left-[-10%] w-[40%] h-[40%] bg-emerald-500/5 blur-[120px] rounded-full"></div>
    <div class="fixed bottom-[-10%] right-[-10%] w-[40%] h-[40%] bg-blue-500/5 blur-[120px] rounded-full"></div>

    <div class="max-w-6xl mx-auto relative z-10">
        <header class="mb-10 flex flex-col md:flex-row md:items-center justify-between gap-6">
            <div>
                <div class="flex items-center gap-3 mb-2">
                    <span class="px-2 py-0.5 rounded text-[10px] font-bold bg-emerald-500/10 text-emerald-500 border border-emerald-500/20 tracking-widest uppercase">Telemetry System</span>
                </div>
                <h1 class="text-5xl font-extrabold text-white tracking-tighter flex items-center gap-4">
                    <div class="relative">
                        <div class="w-4 h-4 bg-emerald-500 rounded-full animate-pulse glow-emerald"></div>
                        <div class="absolute inset-0 w-4 h-4 bg-emerald-400 rounded-full animate-ping opacity-25"></div>
                    </div>
                    AGRI-OS <span class="bg-clip-text text-transparent bg-gradient-to-r from-emerald-400 to-blue-500 uppercase">Live</span>
                </h1>
                <p class="text-slate-500 mt-2 flex items-center gap-2 text-sm font-medium">
                    <i data-lucide="zap" class="w-4 h-4 text-yellow-500/70"></i> 
                    Core Node: <span class="text-slate-300 font-mono">3254588</span>
                </p>
            </div>

            <div class="flex items-center gap-4 bg-slate-900/40 p-2 rounded-2xl border border-white/5 backdrop-blur-md">
                <button onclick="clearGraph()" class="px-4 py-2.5 bg-white/5 border border-white/10 rounded-xl hover:bg-red-500/10 hover:border-red-500/50 transition-all text-[10px] font-bold uppercase tracking-widest text-slate-400 hover:text-red-400 flex items-center gap-2">
                    <i data-lucide="eraser" class="w-3.5 h-3.5"></i> Clear Cache
                </button>
                <div class="h-8 w-[1px] bg-white/5"></div>
                <div class="text-right px-2">
                    <p class="text-[10px] text-slate-500 uppercase font-black tracking-[0.2em]">Live Sync</p>
                    <p id="lastUpdate" class="text-sm text-emerald-400 font-mono font-bold italic">--:--:--</p>
                </div>
                <button onclick="fetchData()" id="refreshBtn" class="p-3 bg-emerald-500/10 border border-emerald-500/20 rounded-xl hover:bg-emerald-500/20 transition-all shadow-lg disabled:opacity-50">
                    <i data-lucide="refresh-cw" id="refreshIcon" class="w-5 h-5 text-emerald-500"></i>
                </button>
            </div>
        </header>

        <div id="errorAlert" class="hidden mb-8 bg-red-950/40 border border-red-500/30 p-4 rounded-2xl text-red-200 flex items-center gap-3 backdrop-blur-xl">
            <i data-lucide="alert-octagon" class="w-5 h-5"></i>
            <p id="errorMessage" class="text-sm font-semibold"></p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-10">
            <div class="liquid-glass rounded-[2rem] p-8 transition-all hover:-translate-y-2 group">
                <div class="absolute top-[-20%] right-[-10%] w-32 h-32 bg-orange-500/5 blur-3xl group-hover:bg-orange-500/10 transition-all"></div>
                <div class="flex justify-between items-start mb-6">
                    <div class="p-4 rounded-2xl bg-gradient-to-br from-orange-500/20 to-orange-600/5 border border-orange-500/20 shadow-inner">
                        <i data-lucide="thermometer" class="text-orange-400 w-7 h-7"></i>
                    </div>
                    <span class="text-slate-500 text-[10px] font-bold uppercase tracking-[0.3em]">Field 01</span>
                </div>
                <h3 class="text-slate-400 text-xs font-bold uppercase tracking-widest mb-1">Ambient Temp</h3>
                <div class="flex items-baseline gap-3">
                    <span id="field1" class="text-5xl font-black text-white tracking-tighter">--</span>
                    <span class="text-orange-500/70 font-black text-xl italic">Â°C</span>
                </div>
            </div>

            <div class="liquid-glass rounded-[2rem] p-8 transition-all hover:-translate-y-2 group">
                <div class="absolute top-[-20%] right-[-10%] w-32 h-32 bg-blue-500/5 blur-3xl group-hover:bg-blue-500/10 transition-all"></div>
                <div class="flex justify-between items-start mb-6">
                    <div class="p-4 rounded-2xl bg-gradient-to-br from-blue-500/20 to-blue-600/5 border border-blue-500/20 shadow-inner">
                        <i data-lucide="droplets" class="text-blue-400 w-7 h-7"></i>
                    </div>
                    <span class="text-slate-500 text-[10px] font-bold uppercase tracking-widest text-slate-300">Field 02</span>
                </div>
                <h3 class="text-slate-400 text-xs font-bold uppercase tracking-widest mb-1">Humidity</h3>
                <div class="flex items-baseline gap-3">
                    <span id="field2" class="text-5xl font-black text-white tracking-tighter">--</span>
                    <span class="text-blue-500/70 font-black text-xl italic">%</span>
                </div>
            </div>

            <div class="liquid-glass rounded-[2rem] p-8 transition-all hover:-translate-y-2 group">
                <div class="absolute top-[-20%] right-[-10%] w-32 h-32 bg-purple-500/5 blur-3xl group-hover:bg-purple-500/10 transition-all"></div>
                <div class="flex justify-between items-start mb-6">
                    <div class="p-4 rounded-2xl bg-gradient-to-br from-purple-500/20 to-purple-600/5 border border-purple-500/20 shadow-inner">
                        <i data-lucide="wind" class="text-purple-400 w-7 h-7"></i>
                    </div>
                    <span class="text-slate-500 text-[10px] font-bold uppercase tracking-[0.3em]">Field 03</span>
                </div>
                <h3 class="text-slate-400 text-xs font-bold uppercase tracking-widest mb-1">VPD Index</h3>
                <div class="flex items-baseline gap-3">
                    <span id="field3" class="text-5xl font-black text-white tracking-tighter">--</span>
                    <span class="text-purple-500/70 font-black text-xl italic">kPa</span>
                </div>
            </div>

            <div class="liquid-glass rounded-[2rem] p-8 transition-all hover:-translate-y-2 group">
                <div class="absolute top-[-20%] right-[-10%] w-32 h-32 bg-emerald-500/5 blur-3xl group-hover:bg-emerald-500/10 transition-all"></div>
                <div class="flex justify-between items-start mb-6">
                    <div class="p-4 rounded-2xl bg-gradient-to-br from-emerald-500/20 to-emerald-600/5 border border-emerald-500/20 shadow-inner">
                        <i data-lucide="gauge" class="text-emerald-400 w-7 h-7"></i>
                    </div>
                    <span class="text-slate-500 text-[10px] font-bold uppercase tracking-[0.3em]">Field 04</span>
                </div>
                <h3 class="text-slate-400 text-xs font-bold uppercase tracking-widest mb-1">Atmospheric</h3>
                <div class="flex items-baseline gap-3">
                    <span id="field4" class="text-5xl font-black text-white tracking-tighter">--</span>
                    <span class="text-emerald-500/70 font-black text-xl italic">kPa</span>
                </div>
            </div>

            <div class="liquid-glass rounded-[2rem] p-8 transition-all hover:-translate-y-2 group">
                <div class="absolute top-[-20%] right-[-10%] w-32 h-32 bg-yellow-500/5 blur-3xl group-hover:bg-yellow-500/10 transition-all"></div>
                <div class="flex justify-between items-start mb-6">
                    <div class="p-4 rounded-2xl bg-gradient-to-br from-yellow-500/20 to-yellow-600/5 border border-yellow-500/20 shadow-inner">
                        <i data-lucide="sun" class="text-yellow-400 w-7 h-7"></i>
                    </div>
                    <span class="text-slate-500 text-[10px] font-bold uppercase tracking-[0.3em]">Field 05</span>
                </div>
                <h3 class="text-slate-400 text-xs font-bold uppercase tracking-widest mb-1">Luminous Flux</h3>
                <div class="flex items-baseline gap-3">
                    <span id="field5" class="text-5xl font-black text-white tracking-tighter">--</span>
                    <span class="text-yellow-500/70 font-black text-xl italic">Lux</span>
                </div>
            </div>

            <div class="liquid-glass rounded-[2rem] p-8 flex flex-col justify-center relative shadow-2xl group border-emerald-500/30">
                <div class="absolute -top-10 -left-10 w-40 h-40 bg-emerald-500/10 animate-liquid blur-xl"></div>
                <div class="relative z-10">
                    <div class="flex items-center gap-2 mb-3">
                        <div class="w-1.5 h-1.5 rounded-full bg-emerald-400"></div>
                        <h3 class="text-emerald-400 font-black text-xs uppercase tracking-[0.2em]">Neural Engine Active</h3>
                    </div>
                    <p class="text-slate-400 text-sm leading-relaxed mb-6">
                        System functioning at <span class="text-white font-bold">99.8%</span> efficiency. Adaptive relay logic enabled for MKR-1010.
                    </p>
                    <a href="https://thingspeak.com/channels/3254588" target="_blank" class="w-full flex items-center justify-between px-5 py-3 rounded-xl bg-white/5 border border-white/10 text-xs font-bold uppercase tracking-widest text-emerald-400 hover:bg-emerald-500/10 transition-all group/link">
                        Intelligence Source <i data-lucide="arrow-up-right" class="w-4 h-4 group-hover/link:translate-x-1 group-hover/link:-translate-y-1 transition-transform"></i>
                    </a>
                </div>
            </div>
        </div>

        <div class="max-w-6xl mx-auto mb-16">
            <div class="liquid-glass rounded-[2.5rem] p-8 md:p-10 shadow-3xl border-white/5">
                <div class="flex flex-col lg:flex-row lg:items-center justify-between mb-10 gap-6">
                    <div>
                        <h2 class="text-2xl font-black text-white flex items-center gap-4">
                            <i data-lucide="line-chart" class="text-emerald-400 w-8 h-8"></i>
                            Environmental Matrix
                        </h2>
                        <p class="text-slate-500 text-sm font-medium mt-1">Spatiotemporal data visualization</p>
                    </div>
                    <div class="flex flex-wrap gap-4">
                        <div class="px-4 py-2 rounded-xl bg-white/5 border border-white/5 flex items-center gap-3">
                            <div class="w-3 h-3 rounded-full bg-orange-500 shadow-[0_0_10px_#f97316]"></div>
                            <span class="text-[10px] font-black uppercase tracking-widest text-slate-300">Temp</span>
                        </div>
                        <div class="px-4 py-2 rounded-xl bg-white/5 border border-white/5 flex items-center gap-3">
                            <div class="w-3 h-3 rounded-full bg-blue-500 shadow-[0_0_10px_#3b82f6]"></div>
                            <span class="text-[10px] font-black uppercase tracking-widest text-slate-300">Humid</span>
                        </div>
                        <div class="px-4 py-2 rounded-xl bg-white/5 border border-white/5 flex items-center gap-3">
                            <div class="w-3 h-3 rounded-full bg-purple-500 shadow-[0_0_10px_#a855f7]"></div>
                            <span class="text-[10px] font-black uppercase tracking-widest text-slate-300">VPD</span>
                        </div>
                    </div>
                </div>
                <div class="h-[450px] w-full chart-container">
                    <canvas id="trendChart"></canvas>
                </div>
            </div>
        </div>

        <footer class="pb-12 text-center">
            <div class="inline-block px-6 py-2 rounded-full bg-white/5 border border-white/5 text-[10px] font-black tracking-[0.4em] uppercase text-slate-500">
                AGRI-OS // Advanced Agriculture Operating System v2.0
            </div>
        </footer>
    </div>

    <script>
        const channelId = "3254588";
        const readApiKey = "YIPXD4IMUVM0MYR5";
        let trendChart;

        const pCanvas = document.getElementById('particle-canvas');
        const pCtx = pCanvas.getContext('2d');
        let particles = [];
        
        function resizeCanvas() {
            pCanvas.width = window.innerWidth;
            pCanvas.height = window.innerHeight;
        }

        class Particle {
            constructor() { this.reset(); }
            reset() {
                this.x = Math.random() * pCanvas.width;
                this.y = Math.random() * pCanvas.height;
                this.size = Math.random() * 2 + 0.5;
                this.speedX = Math.random() * 0.5 - 0.25;
                this.speedY = Math.random() * 0.5 - 0.25;
                this.opacity = Math.random() * 0.3 + 0.1;
            }
            update() {
                this.x += this.speedX;
                this.y += this.speedY;
                if (this.x < 0 || this.x > pCanvas.width || this.y < 0 || this.y > pCanvas.height) this.reset();
            }
            draw() {
                pCtx.fillStyle = `rgba(16, 185, 129, ${this.opacity})`;
                pCtx.beginPath();
                pCtx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                pCtx.fill();
            }
        }

        function initParticles() {
            particles = [];
            const count = Math.floor((pCanvas.width * pCanvas.height) / 10000);
            for (let i = 0; i < count; i++) particles.push(new Particle());
        }

        function animateParticles() {
            pCtx.clearRect(0, 0, pCanvas.width, pCanvas.height);
            particles.forEach(p => { p.update(); p.draw(); });
            requestAnimationFrame(animateParticles);
        }

        window.addEventListener('resize', () => { resizeCanvas(); initParticles(); });

        function initChart() {
            const ctx = document.getElementById('trendChart').getContext('2d');
            trendChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        { label: 'Temperature', data: [], borderColor: '#f97316', borderWidth: 4, tension: 0.45, pointRadius: 0, pointHoverRadius: 6, pointHoverBackgroundColor: '#f97316', pointHoverBorderColor: '#fff', pointHoverBorderWidth: 3, fill: false },
                        { label: 'Humidity', data: [], borderColor: '#3b82f6', borderWidth: 4, tension: 0.45, pointRadius: 0, pointHoverRadius: 6, pointHoverBackgroundColor: '#3b82f6', pointHoverBorderColor: '#fff', pointHoverBorderWidth: 3, fill: false },
                        { label: 'VPD Scan', data: [], borderColor: '#a855f7', borderWidth: 2, borderDash: [8, 5], tension: 0.45, pointRadius: 0, fill: false }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: {
                        legend: { display: false },
                        tooltip: { backgroundColor: 'rgba(15, 23, 42, 0.9)', backdropFilter: 'blur(8px)', titleFont: { family: 'Plus Jakarta Sans', size: 13, weight: 'bold' }, bodyFont: { family: 'Plus Jakarta Sans', size: 12 }, padding: 16, borderColor: 'rgba(255, 255, 255, 0.1)', borderWidth: 1, cornerRadius: 16, usePointStyle: true, boxPadding: 8 }
                    },
                    scales: {
                        x: { grid: { display: false }, ticks: { color: '#64748b', font: { family: 'Plus Jakarta Sans', size: 10, weight: '600' }, maxTicksLimit: 6 }, border: { display: false } },
                        y: { grid: { color: 'rgba(255, 255, 255, 0.03)', drawTicks: false }, ticks: { color: '#64748b', font: { family: 'Plus Jakarta Sans', size: 10, weight: '600' }, padding: 10 }, border: { display: false } }
                    }
                }
            });
        }

        function clearGraph() {
            trendChart.data.labels = [];
            trendChart.data.datasets.forEach(dataset => dataset.data = []);
            trendChart.update('active');
        }

        async function fetchData() {
            const refreshIcon = document.getElementById('refreshIcon');
            const errorAlert = document.getElementById('errorAlert');
            const refreshBtn = document.getElementById('refreshBtn');
            const lastUpdateEl = document.getElementById('lastUpdate');
            refreshIcon.classList.add('animate-spin');
            refreshBtn.disabled = true;
            try {
                const url = `https://api.thingspeak.com/channels/${channelId}/feeds.json?api_key=${readApiKey}&results=20`;
                const response = await fetch(url);
                if (!response.ok) throw new Error('Uplink Interrupted');
                const result = await response.json();
                if (result.feeds && result.feeds.length > 0) {
                    const latest = result.feeds[result.feeds.length - 1];
                    document.getElementById('field1').textContent = latest.field1 ? parseFloat(latest.field1).toFixed(1) : '--';
                    document.getElementById('field2').textContent = latest.field2 ? Math.round(latest.field2) : '--';
                    document.getElementById('field3').textContent = latest.field3 ? parseFloat(latest.field3).toFixed(2) : '--';
                    document.getElementById('field4').textContent = latest.field4 ? parseFloat(latest.field4).toFixed(1) : '--';
                    document.getElementById('field5').textContent = latest.field5 ? Math.round(latest.field5) : '--';
                    lastUpdateEl.textContent = new Date().toLocaleTimeString([], { hour12: false });
                    errorAlert.classList.add('hidden');
                    const labels = result.feeds.map(f => {
                        const date = new Date(f.created_at);
                        return `${date.toLocaleDateString([], { month: 'short', day: 'numeric' })}, ${date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', hour12: false })}`;
                    });
                    trendChart.data.labels = labels;
                    trendChart.data.datasets[0].data = result.feeds.map(f => parseFloat(f.field1));
                    trendChart.data.datasets[1].data = result.feeds.map(f => parseFloat(f.field2));
                    trendChart.data.datasets[2].data = result.feeds.map(f => parseFloat(f.field3));
                    trendChart.update('none'); 
                } else {
                    throw new Error('Zero Data Payload Received');
                }
            } catch (err) {
                errorAlert.classList.remove('hidden');
                document.getElementById('errorMessage').textContent = `CRITICAL_ERROR: ${err.message}`;
            } finally {
                setTimeout(() => {
                    refreshIcon.classList.remove('animate-spin');
                    refreshBtn.disabled = false;
                }, 800);
            }
        }

        window.onload = () => {
            lucide.createIcons();
            resizeCanvas();
            initParticles();
            animateParticles();
            initChart();
            fetchData();
            setInterval(fetchData, 20000);
        };
    </script>
</body>
</html>
